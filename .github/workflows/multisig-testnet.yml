name: Deploy Multisig Testnet to Indexer VM
run-name: ${{ github.actor }} is deploying Multisig Testnet to Indexer VM
on:
  push:
    branches:
      - 'features/implement-multisig-transaction-testnet'
jobs:
  deploy:
    runs-on: multisig-testnet # 236416
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - run: |
          docker stop multisig-indexer
          docker rm multisig-indexer
          docker rmi multisig-indexer
          docker builder prune --all -f
          cd rust
          echo "${{ secrets.ENV_FILE_MULTISIG_TESTNET }}" >> config.yaml
          docker build . -t multisig-indexer
          docker run --name multisig-indexer -d --restart=always -it --mount type=bind,source=./config.yaml,target=/config.yaml multisig-indexer -c /config.yaml
          # Remove the last line from the config.yaml file (start_ver)
          sed -i '$ d' config.yaml
          docker image prune -f
